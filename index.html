<div id="statusText">Connecting...</div>
<div id="board" style="display:grid; grid-template-columns: repeat(3, 100px); gap: 5px;"></div>

<script>
  let ws;
  let playerId = null;
  let gameState = null;

  function connect(roomCode) {
    ws = new WebSocket(`wss://YOUR_WORKER_DOMAIN/tictactoe/join/${roomCode}`);

    ws.onopen = () => {
      document.getElementById('statusText').textContent = "Connected. Waiting for opponent...";
    };

    ws.onmessage = event => {
      const data = JSON.parse(event.data);
      switch(data.type) {
        case "init":
          playerId = data.playerId;
          gameState = data.state;
          renderBoard();
          updateStatus();
          break;
        case "update":
        case "sync":
          gameState = data.state;
          renderBoard();
          updateStatus();
          break;
        case "playerLeft":
          document.getElementById('statusText').textContent = "Opponent left. Waiting for new opponent...";
          break;
        default:
          console.warn("Unknown message:", data);
      }
    };

    ws.onclose = () => {
      document.getElementById('statusText').textContent = "Disconnected.";
    };
  }

  function renderBoard() {
    const boardDiv = document.getElementById("board");
    boardDiv.innerHTML = '';
    gameState.board.forEach((cell, idx) => {
      const cellDiv = document.createElement("div");
      cellDiv.className = "cell";
      cellDiv.style.width = "100px";
      cellDiv.style.height = "100px";
      cellDiv.style.border = "1px solid black";
      cellDiv.style.display = "flex";
      cellDiv.style.alignItems = "center";
      cellDiv.style.justifyContent = "center";
      cellDiv.style.fontSize = "3rem";
      cellDiv.style.cursor = "default";

      cellDiv.textContent = cell || "";

      // Enable click only if it's player's turn, cell empty, and game not over
      if (!cell && !gameState.gameOver && gameState.currentPlayer === playerId) {
        cellDiv.style.cursor = "pointer";
        cellDiv.onclick = () => {
          ws.send(JSON.stringify({ type: "move", playerId, index: idx }));
        };
      }

      boardDiv.appendChild(cellDiv);
    });
  }

  function updateStatus() {
    const statusDiv = document.getElementById('statusText');
    if (gameState.sessions?.length < 2) {
      statusDiv.textContent = "Waiting for opponent...";
    } else if (gameState.gameOver) {
      statusDiv.textContent = gameState.winner === "draw" ? "It's a draw!" : `${gameState.winner} wins!`;
    } else {
      statusDiv.textContent = gameState.currentPlayer === playerId ? "Your turn" : "Opponent's turn";
    }
  }

  // Example usage: connect with a fixed room code
  connect("SOMECODE");
</script>
