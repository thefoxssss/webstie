<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Crown Castle</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  html,body{margin:0;height:100%;background:#0a0a0a;display:flex;justify-content:center;align-items:center}
  canvas{image-rendering:pixelated;image-rendering:crisp-edges;background:#1a1a2e;border:2px solid #444}
  #c{position:relative}
  #w{position:absolute;inset:0;display:flex;justify-content:center;align-items:center;color:#fff;font-family:monospace;text-align:center;pointer-events:none}
  #w button{margin-top:8px;padding:4px 8px;font:inherit;pointer-events:auto}
</style>
</head>
<body>
<div id="c">
  <canvas id="g" width="240" height="160"></canvas>
  <div id="w" style="display:none">
    <div>
      <div id="wt"></div>
      <button onclick="reset()">Play Again</button>
    </div>
  </div>
</div>
<script>
/* --------- params --------- */
const W=240,H=160,GRAV=0.3,JUMP=-5,SPD=1.2,ENEMY_SPD=0.4;
const TILE=8,PLATFORMS=[
  {x:0,y:140,w:240},          // ground
  {x:40,y:100,w:80},          // mid-left
  {x:140,y:80,w:60},          // mid-right
  {x:90,y:50,w:60}            // top
];
const ENEMY={x:120,y:132,w:8,h:8,dir:-1};
const CROWN={x:180,y:20,w:8,h:8,collected:false};
const DOOR={x:220,y:112,w:16,h:28,open:false};
/* --------- state --------- */
let ctx=document.getElementById('g').getContext('2d');
ctx.imageSmoothingEnabled=false;
let p={x:10,y:100,w:8,h:8,vx:0,vy:0,onground:false};
let enemy={...ENEMY};
let crown={...CROWN};
let door={...DOOR};
let keys={},start=Date.now(),best=localStorage.best||0,win=false;
/* --------- input --------- */
onkeydown=e=>keys[e.key]="1";
onkeyup=e=>keys[e.key]=0;
/* --------- loop --------- */
requestAnimationFrame(loop);
function loop(){
  if(!win)update();
  draw();
  requestAnimationFrame(loop);
}
function update(){
  /* player input */
  if(keys["ArrowLeft"]||keys["a"])p.vx=-SPD;
  else if(keys["ArrowRight"]||keys["d"])p.vx=SPD;
  else p.vx*=0.8;
  if((keys[" "]||keys["ArrowUp"]||keys["w"])&&p.onground){p.vy=JUMP;keys[" "]=0}
  /* gravity */
  p.vy+=GRAV;
  if(p.vy>5)p.vy=5;
  /* move */
  move(p);
  /* enemy */
  enemy.x+=enemy.dir*ENEMY_SPD;
  if(enemy.x<20||enemy.x>180)enemy.dir*=-1;
  if(aabb(p,enemy))reset();          // touch = die
  /* crown */
  if(!crown.collected&&aabb(p,crown)){crown.collected=true;door.open=true}
  /* door */
  if(door.open&&aabb(p,door))win=true;
}
function move(ent){
  ent.onground=false;
  ent.x+=ent.vx;
  for(let b of PLATFORMS){
    if(ent.vx>0&&ent.x> b.x-TILE&&ent.x< b.x+b.w&&ent.y>b.y-TILE&&ent.y<b.y+TILE)
      ent.x=b.x-TILE;
    if(ent.vx<0&&ent.x> b.x+b.w&&ent.x< b.x+b.w+TILE&&ent.y>b.y-TILE&&ent.y<b.y+TILE)
      ent.x=b.x+b.w;
  }
  ent.y+=ent.vy;
  for(let b of PLATFORMS){
    if(ent.vy>0&&ent.x+ent.w>b.x&&ent.x<b.x+b.w&&ent.y+ent.h>b.y&&ent.y+ent.h<b.y+TILE){
      ent.y=b.y-ent.h;ent.vy=0;ent.onground=true;
    }
    if(ent.vy<0&&ent.x+ent.w>b.x&&ent.x<b.x+b.w&&ent.y>b.y+TILE&&ent.y<b.y+b.h){
      ent.y=b.y+b.h;ent.vy=0;
    }
  }
  if(ent.y>H){reset()} // fell
}
function aabb(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y}
function reset(){
  p={x:10,y:100,w:8,h:8,vx:0,vy:0,onground:false};
  enemy={...ENEMY};
  crown={...CROWN,collected:false};
  door={...DOOR,open:false};
  win=false;
  start=Date.now();
  document.getElementById('w').style.display='none';
}
/* --------- draw --------- */
function draw(){
  ctx.fillStyle="#1a1a2e";ctx.fillRect(0,0,W,H);
  /* parallax bg */
  ctx.fillStyle="#16213e";for(let i=0;i<6;i++){ctx.fillRect(i*40-(Date.now()/50)%40,20,20,60)}
  /* platforms */
  ctx.fillStyle="#444";
  for(let b of PLATFORMS)ctx.fillRect(b.x,b.y,b.w,TILE);
  /* door */
  ctx.fillStyle=door.open?"#6a4":"#333";
  ctx.fillRect(door.x,door.y,door.w,door.h);
  /* crown */
  if(!crown.collected){ctx.fillStyle="#ffd93d";pixelCrown(crown.x,crown.y)}
  /* enemy */
  ctx.fillStyle="#e94560";ctx.fillRect(enemy.x,enemy.y,enemy.w,enemy.h);
  /* player */
  ctx.fillStyle="#f3f3f3";ctx.fillRect(p.x,p.y,p.w,p.h);
  /* hud */
  ctx.fillStyle="#fff";
  ctx.font="8px monospace";
  let t=((Date.now()-start)/1000).toFixed(1);
  ctx.fillText(`Time ${t}s`+(best?`  Best ${best}s`:''),4,10);
  if(win){
    if(!best||t<best){best=t;localStorage.best=best}
    document.getElementById('wt').textContent=`You got the Crown! Time ${t}s`;
    document.getElementById('w').style.display='flex';
  }
}
function pixelCrown(x,y){
  ctx.fillRect(x+2,y,4,1);
  ctx.fillRect(x+1,y+1,6,1);
  ctx.fillRect(x,y+2,8,2);
  ctx.fillRect(x+1,y+4,6,1);
}
</script>
</body>
</html>
