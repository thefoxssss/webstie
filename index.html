<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>What up Gooner</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root { --bg: #000; --accent: #ff0606; }
html,body { height:100%; margin:0; background:var(--bg); font-family:"Press Start 2P",monospace; overflow:hidden; color:var(--accent); -webkit-tap-highlight-color: transparent;}
.wrap { height:100%; display:flex; align-items:center; justify-content:center; position:relative; user-select:none; text-align:center; padding:10px;}
.gooner { font-size: clamp(24px,8vw,72px); color:var(--accent); cursor:pointer; padding:20px 30px; border:5px solid var(--accent); border-radius:8px; letter-spacing:4px; background:rgba(255,6,6,0.02); transition: transform 200ms ease, box-shadow 200ms ease; box-shadow: 0 6px 0 rgba(0,0,0,0.6); touch-action:manipulation;}
.gooner:hover { transform: translateY(-8px) scale(1.04); box-shadow: 0 14px 0 rgba(0,0,0,0.6); text-shadow:2px 2px 0 rgba(0,0,0,0.9);}
.gooner:active { transform: translateY(-3px) scale(0.97); box-shadow: 0 4px 0 rgba(0,0,0,0.6);}
.hint { position:absolute; bottom:80px; left:50%; transform:translateX(-50%); font-size:clamp(10px,3vw,14px); color:rgba(255,6,6,0.6); letter-spacing:2px;}
.home-input-container { position:absolute; bottom:20px; left:50%; transform:translateX(-50%); width:80%; max-width:400px; }
.home-input { width:100%; background:rgba(255,6,6,0.1); border:2px solid var(--accent); color:var(--accent); padding:12px 15px; font-family:"Press Start 2P",monospace; font-size:clamp(10px,2.5vw,14px); border-radius:6px; outline:none; text-align:center; letter-spacing:2px; box-sizing: border-box; -webkit-appearance: none; }
.home-input::placeholder { color:rgba(255,6,6,0.5); }
.home-input:focus { background:rgba(255,6,6,0.15); box-shadow:0 0 10px rgba(255,6,6,0.3); }

/* Mobile optimizations */
@media (max-width: 768px) {
  .wrap { padding: 20px 10px; }
  .gooner { font-size: clamp(20px, 6vw, 48px); padding: 15px 20px; }
  .hint { bottom: 90px; font-size: clamp(9px, 2.5vw, 12px); }
  .home-input-container { width: 90%; bottom: 15px; }
  .home-input { padding: 10px 12px; font-size: clamp(9px, 2.5vw, 12px); }
  .chat-container { width: 95%; height: 65vh; padding: 15px; }
  .chat-message { padding: 12px; font-size: clamp(9px, 2.5vw, 12px); }
  .chat-input { padding: 10px; font-size: clamp(9px, 2.5vw, 11px); }
  .chat-send-btn { padding: 10px 15px; font-size: clamp(9px, 2.5vw, 11px); min-width: 60px; }
  #overlayPong h1, #overlaySnake h1, #overlayRunner h1 { font-size: clamp(20px, 6vw, 48px); margin-bottom: 10px; }
  .difficulty-btn { padding: 8px 15px; margin: 5px; font-size: clamp(9px, 2.5vw, 11px); }
  .touch-controls.active { grid-template-columns: repeat(3, 50px); grid-template-rows: repeat(3, 50px); gap: 8px; }
  .touch-btn { font-size: 20px; }
}
.hidden-text{ position:fixed; top:10px; left:10px; font-size:clamp(8px,2.5vw,12px); color:rgba(255,6,6,0.6); pointer-events:auto; cursor:pointer; z-index:10001; animation: glitch 1.5s 3s;}
.version{ position:fixed; top:10px; right:10px; font-size:clamp(8px,2.5vw,12px); color:rgba(255,6,6,0.6); z-index:10001; letter-spacing:1px;}
@keyframes glitch {0% {text-shadow:2px 0 var(--accent);}20% {text-shadow:-2px 0 var(--accent);}40% {text-shadow:2px 2 var(--accent);}60% {text-shadow:-2px -2 var(--accent);}80% {text-shadow:2px -2 var(--accent);}100% {text-shadow:none;}}
.overlay { position:fixed; inset:0; background:var(--bg); display:none; align-items:center; justify-content:center; z-index:9999; overflow:hidden; flex-direction:column;}
.overlay.active { display:flex;}
.surface { position:relative; width:100%; height:100%; }
.stamp { position:absolute; color:var(--accent); font-size:clamp(28px,10vw,160px); opacity:0; pointer-events:none; animation: flash 1s linear infinite; text-align:center;}
@keyframes flash {0%,100%{opacity:0;transform:scale(0.9);} 20%,80%{opacity:1;transform:scale(1);}}
.center-giant { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:clamp(48px,14vw,240px); opacity:0; pointer-events:none; animation:pulse 1.2s ease-in-out infinite;}
@keyframes pulse {0%{opacity:0;transform:translate(-50%,-50%) scale(0.9);}50%{opacity:1;transform:translate(-50%,-50%) scale(1.05);}100%{opacity:0;transform:translate(-50%,-50%) scale(0.95);}}
.glitch-static { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:clamp(40px,12vw,200px); color:white; animation: tvGlitch 0.8s infinite; letter-spacing:2px;}
@keyframes tvGlitch {0% { transform: translate(-50%,-50%) skew(0deg); opacity:1; }20% { transform: translate(-51%,-49%) skew(-1deg); opacity:1; }50% { transform: translate(-50%,-50%) skew(2deg); opacity:.9; }100% { transform: translate(-50%,-50%) skew(0deg); opacity:1; } }
.close-btn{ position:fixed; top:10px; right:10px; font-size:clamp(10px,4vw,14px); border:2px solid var(--accent); color:var(--accent); background:transparent; padding:6px 10px; border-radius:6px; cursor:pointer; z-index:10000;}
.close-btn:active{ transform:scale(0.9);}
#overlayPong canvas, #overlaySnake canvas, #overlayRunner canvas { border:4px solid var(--accent); background:black; max-width: 100%; height: auto; display: block; margin: 0 auto; touch-action: none; }
#overlayPong h1, #overlaySnake h1, #overlayRunner h1 { color:var(--accent); font-size: clamp(24px, 8vw, 72px); margin-bottom:20px; text-align:center; }
#overlayPong .difficulty-btn { color: var(--accent); background:transparent; border:2px solid var(--accent); padding:10px 20px; margin:10px; cursor:pointer; font-family:"Press Start 2P", monospace; font-size:clamp(10px,2.5vw,12px); border-radius:8px;}
#scoreboard, #snakeScore, #runnerScore { margin-top:10px; font-size: clamp(12px, 3vw, 18px); padding: 10px; }
#winLoseScreen { display:none; flex-direction:column; align-items:center; justify-content:center; position:fixed; inset:0; background:var(--bg); color:var(--accent); font-family:"Press Start 2P",monospace; z-index:10000;}
#winLoseScreen h1 { font-size:clamp(24px,8vw,72px); margin-bottom:20px; text-align:center; }
#winLoseScreen button { color:var(--accent); background:transparent; border:2px solid var(--accent); padding:10px 20px; margin-top:20px; cursor:pointer; border-radius:8px; font-family:"Press Start 2P",monospace; font-size:14px;}
#snakeGameOver, #runnerGameOver { display:none; flex-direction:column; align-items:center; justify-content:center; position:fixed; inset:0; background:var(--bg); color:var(--accent); font-family:"Press Start 2P",monospace; z-index:10000;}
#snakeGameOver h1, #runnerGameOver h1 { font-size:clamp(24px,8vw,72px); margin-bottom:20px; text-align:center; }
#snakeGameOver .score-text, #runnerGameOver .score-text { font-size:clamp(16px,4vw,24px); margin-bottom:20px; }
#snakeGameOver button, #runnerGameOver button { color:var(--accent); background:transparent; border:2px solid var(--accent); padding:10px 20px; margin-top:20px; cursor:pointer; border-radius:8px; font-family:"Press Start 2P",monospace; font-size:14px;}
.touch-controls { display:none; position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:10000; }
.touch-controls.active { display:grid; grid-template-columns: repeat(3, 60px); grid-template-rows: repeat(3, 60px); gap:10px; }
.touch-btn { background:rgba(255,6,6,0.3); border:2px solid var(--accent); color:var(--accent); font-size:24px; border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:center; user-select:none; touch-action:manipulation;}
.touch-btn:active { background:rgba(255,6,6,0.6); transform:scale(0.95); }
.touch-btn.empty { opacity:0; pointer-events:none; }
.mobile-hint { display:none; position:fixed; bottom:200px; left:50%; transform:translateX(-50%); font-size:clamp(10px,3vw,14px); color:rgba(255,6,6,0.6); text-align:center; z-index:9998; }
.mobile-hint.active { display:block; }

/* AI Chat Styles */
#overlayAI { background: var(--bg); overflow: hidden; }
#overlayAI h1 { color:var(--accent); font-size: clamp(20px, 6vw, 48px); margin-bottom:20px; text-align:center; }
.chat-container { width: 90%; max-width: 800px; height: 70vh; display: flex; flex-direction: column; border: 4px solid var(--accent); background: rgba(255,6,6,0.05); border-radius: 8px; padding: 20px; }
.chat-messages { flex: 1; overflow-y: scroll; overflow-x: hidden; margin-bottom: 20px; display: flex; flex-direction: column; gap: 15px; padding-right: 10px; -webkit-overflow-scrolling: touch; }
.chat-message { padding: 15px; border-radius: 8px; font-size: clamp(10px, 2.5vw, 14px); line-height: 1.6; word-wrap: break-word; word-break: break-word; animation: messageSlide 0.3s ease; }
.chat-message img { max-width: 100%; height: auto; border-radius: 6px; margin: 8px 0; display: block; border: 2px solid var(--accent); }
@keyframes messageSlide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.chat-message.user { background: rgba(255,6,6,0.2); border: 2px solid var(--accent); align-self: flex-end; max-width: 80%; text-align: right; }
.chat-message.ai { background: rgba(255,6,6,0.1); border: 2px solid rgba(255,6,6,0.5); align-self: flex-start; max-width: 80%; }
.chat-input-container { display: flex; gap: 10px; flex-wrap: nowrap; }
.chat-input { flex: 1; background: rgba(255,6,6,0.1); border: 2px solid var(--accent); color: var(--accent); padding: 12px; font-family: "Press Start 2P", monospace; font-size: clamp(10px, 2.5vw, 12px); border-radius: 6px; outline: none; min-width: 0; }
.chat-input::placeholder { color: rgba(255,6,6,0.5); }
.chat-send-btn { background: transparent; border: 2px solid var(--accent); color: var(--accent); padding: 12px 20px; cursor: pointer; font-family: "Press Start 2P", monospace; font-size: clamp(10px, 2.5vw, 12px); border-radius: 6px; transition: all 0.2s; white-space: nowrap; flex-shrink: 0; }
.chat-send-btn:hover { background: rgba(255,6,6,0.2); transform: scale(1.05); }
.chat-send-btn:active { transform: scale(0.95); }
.typing-indicator { padding: 15px; font-size: clamp(10px, 2.5vw, 14px); color: rgba(255,6,6,0.6); align-self: flex-start; background: rgba(255,6,6,0.05); border: 2px solid rgba(255,6,6,0.3); border-radius: 8px; max-width: 80%; animation: pulse 1s ease-in-out infinite; }
@keyframes pulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
.chat-messages::-webkit-scrollbar { width: 8px; }
.chat-messages::-webkit-scrollbar-track { background: rgba(255,6,6,0.1); border-radius: 4px; }
.chat-messages::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }
.chat-messages::-webkit-scrollbar-thumb:hover { background: #ff3333; }
</style>
</head>
<body>
<div class="hidden-text" id="hiddenText">you're cool</div>
<div class="version">v10.0 DALLE</div>
<div class="wrap">
  <div class="gooner" id="mainGooner">what up gooner</div>
  <div class="hint">type a secret code below</div>
  <div class="home-input-container">
    <input type="text" class="home-input" id="homeInput" placeholder="enter code..." autocomplete="off" />
  </div>
</div>

<div class="overlay" id="overlayGonner">
  <button class="close-btn" data-close="overlayGonner">CLOSE</button>
  <div class="surface" id="surfaceGonner"></div>
  <div class="center-giant">GONNER</div>
</div>

<div class="overlay" id="overlayWhy">
  <button class="close-btn" data-close="overlayWhy">CLOSE</button>
  <div class="glitch-static">WHY ARE YOU HERE</div>
</div>

<div class="overlay" id="overlayPong">
  <button class="close-btn" data-close="overlayPong">CLOSE</button>
  <h1>PONG</h1>
  <div>
    <button class="difficulty-btn" data-speed="8" data-ai="0.04" data-ball="8">EASY</button>
    <button class="difficulty-btn" data-speed="8" data-ai="0.07" data-ball="10">MEDIUM</button>
    <button class="difficulty-btn" data-speed="12" data-ai="0.12" data-ball="16">HARD</button>
  </div>
  <div id="scoreboard">0 : 0</div>
  <canvas id="pongCanvas" width="800" height="600"></canvas>
  <div class="mobile-hint" id="pongMobileHint">Use buttons below to move</div>
  <div class="touch-controls" id="pongControls">
    <div class="touch-btn empty"></div>
    <div class="touch-btn" data-pong-dir="up">▲</div>
    <div class="touch-btn empty"></div>
    <div class="touch-btn empty"></div>
    <div class="touch-btn empty"></div>
    <div class="touch-btn empty"></div>
    <div class="touch-btn empty"></div>
    <div class="touch-btn" data-pong-dir="down">▼</div>
    <div class="touch-btn empty"></div>
  </div>
</div>

<div class="overlay" id="overlaySnake">
  <button class="close-btn" data-close="overlaySnake">CLOSE</button>
  <h1>SNAKE</h1>
  <div id="snakeScore">0</div>
  <canvas id="snakeCanvas" width="600" height="400"></canvas>
  <div class="mobile-hint" id="snakeMobileHint">Swipe or use buttons to move</div>
  <div class="touch-controls" id="snakeControls">
    <div class="touch-btn empty"></div>
    <div class="touch-btn" data-snake-dir="UP">▲</div>
    <div class="touch-btn empty"></div>
    <div class="touch-btn" data-snake-dir="LEFT">◄</div>
    <div class="touch-btn empty"></div>
    <div class="touch-btn" data-snake-dir="RIGHT">►</div>
    <div class="touch-btn empty"></div>
    <div class="touch-btn" data-snake-dir="DOWN">▼</div>
    <div class="touch-btn empty"></div>
  </div>
</div>

<div class="overlay" id="overlayRunner">
  <button class="close-btn" data-close="overlayRunner">CLOSE</button>
  <h1>RUNNER</h1>
  <div id="runnerScore">SCORE: 0</div>
  <canvas id="runnerCanvas" width="800" height="400"></canvas>
  <div class="mobile-hint" id="runnerMobileHint">Tap to jump, swipe left/right to change lanes</div>
</div>

<div class="overlay" id="overlayAI">
  <button class="close-btn" data-close="overlayAI">CLOSE</button>
  <h1>AI ASSISTANT</h1>
  <div class="chat-container">
    <div class="chat-messages" id="chatMessages">
      <div class="chat-message ai">Hey! I'm your maximized AI ready for OpenAI DALL-E 3 image generation! Just add your API key to the code, then ask me to "generate an image of [anything]" for professional AI art. I also have extensive knowledge about science, tech, history, philosophy, math, and more. Click 📷 to upload images. What's on your mind?</div>
    </div>
    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." />
      <button class="chat-send-btn" id="chatSendBtn">SEND</button>
    </div>
  </div>
</div>

<div id="winLoseScreen">
  <h1 id="winLoseMessage">YOU WIN</h1>
  <button id="tryAgainBtn">TRY AGAIN</button>
</div>

<div id="snakeGameOver">
  <h1>GAME OVER</h1>
  <div class="score-text">FINAL SCORE: <span id="finalSnakeScore">0</span></div>
  <button id="snakePlayAgainBtn">PLAY AGAIN</button>
  <button id="snakeCloseBtn">CLOSE</button>
</div>

<div id="runnerGameOver">
  <h1>GAME OVER</h1>
  <div class="score-text">FINAL SCORE: <span id="finalRunnerScore">0</span></div>
  <button id="runnerPlayAgainBtn">PLAY AGAIN</button>
  <button id="runnerCloseBtn">CLOSE</button>
</div>

<script>
/*
 * ==========================================
 * 🎨 OPENAI DALL-E 3 IMAGE GENERATION 🎨
 * ==========================================
 * 
 * This is ready for DALL-E 3!
 * Just add your OpenAI API key:
 * 
 * 📍 LOCATION: Line ~575 in the code
 * 
 * Look for:
 *   const AI_IMAGE_CONFIG = {
 *     provider: 'openai',
 *     openai: {
 *       apiKey: '',  ← PASTE YOUR KEY HERE
 * 
 * 🔑 GET YOUR KEY:
 * 1. Go to: https://platform.openai.com/api-keys
 * 2. Click "Create new secret key"
 * 3. Copy the key (starts with sk-proj-...)
 * 4. Paste it between the quotes: apiKey: 'sk-proj-...'
 * 5. Save and refresh!
 * 
 * 💰 COST: ~$0.04 per image (DALL-E 3)
 * 
 * ⚠️ SECURITY: Keep your key private!
 * - Don't share your HTML file publicly
 * - Don't commit to GitHub with the key
 * - For production, use a backend server
 * 
 * ==========================================
 */

function rand(min,max){return Math.random()*(max-min)+min;}
function populateStamps(surface,text,count=30){
  surface.innerHTML='';
  for(let i=0;i<count;i++){
    const s=document.createElement('div');
    s.className='stamp';
    s.textContent=text;
    s.style.left=rand(-10,90)+'vw';
    s.style.top=rand(-10,90)+'vh';
    s.style.animationDelay=rand(0,1)+'s';
    s.style.animationDuration=rand(0.8,1.6)+'s';
    surface.appendChild(s);
  }
}

// Main elements
const main=document.getElementById('mainGooner');
const hiddenText=document.getElementById('hiddenText');
const overlayGonner=document.getElementById('overlayGonner');
const overlayWhy=document.getElementById('overlayWhy');
const surfaceGonner=document.getElementById('surfaceGonner');
const homeInput=document.getElementById('homeInput');

// Pong elements
const overlayPong=document.getElementById('overlayPong');
const pongCanvas=document.getElementById('pongCanvas');
const ctx=pongCanvas.getContext('2d');
const scoreboard=document.getElementById('scoreboard');
const winLoseScreen=document.getElementById('winLoseScreen');
const winLoseMessage=document.getElementById('winLoseMessage');
const tryAgainBtn=document.getElementById('tryAgainBtn');
let pongAnimation=null;

// Snake elements
const overlaySnake=document.getElementById('overlaySnake');
const snakeCanvas=document.getElementById('snakeCanvas');
const snakeCtx=snakeCanvas.getContext('2d');
const snakeScoreDisplay=document.getElementById('snakeScore');
const snakeGameOver=document.getElementById('snakeGameOver');
const finalSnakeScore=document.getElementById('finalSnakeScore');
const snakePlayAgainBtn=document.getElementById('snakePlayAgainBtn');
const snakeCloseBtn=document.getElementById('snakeCloseBtn');
let snake,direction,food,snakeScore,snakeAnimation,snakeRunning=false;

// Runner elements
const overlayRunner=document.getElementById('overlayRunner');
const runnerCanvas=document.getElementById('runnerCanvas');
const runnerCtx=runnerCanvas.getContext('2d');
const runnerScoreDisplay=document.getElementById('runnerScore');
const runnerGameOver=document.getElementById('runnerGameOver');
const finalRunnerScore=document.getElementById('finalRunnerScore');
const runnerPlayAgainBtn=document.getElementById('runnerPlayAgainBtn');
const runnerCloseBtn=document.getElementById('runnerCloseBtn');
const runnerMobileHint=document.getElementById('runnerMobileHint');
let runnerAnimation,runnerRunning=false,runnerScore,runnerPlayer,runnerObstacles,runnerSpeed;

// Touch controls
const pongControls=document.getElementById('pongControls');
const snakeControls=document.getElementById('snakeControls');
const pongMobileHint=document.getElementById('pongMobileHint');
const snakeMobileHint=document.getElementById('snakeMobileHint');
const isMobile='ontouchstart'in window||navigator.maxTouchPoints>0;

// Resize canvas for mobile
function resizeCanvas(canvas,maxWidth,maxHeight){
  if(window.innerWidth<800){
    const scale=Math.min(window.innerWidth*0.9/maxWidth,(window.innerHeight*0.5)/maxHeight);
    canvas.style.width=(maxWidth*scale)+'px';
    canvas.style.height=(maxHeight*scale)+'px';
  }else{
    canvas.style.width=maxWidth+'px';
    canvas.style.height=maxHeight+'px';
  }
}

// Apply canvas sizing
window.addEventListener('load',()=>{
  resizeCanvas(pongCanvas,800,600);
  resizeCanvas(snakeCanvas,600,400);
  resizeCanvas(runnerCanvas,800,400);
});

window.addEventListener('resize',()=>{
  resizeCanvas(pongCanvas,800,600);
  resizeCanvas(snakeCanvas,600,400);
  resizeCanvas(runnerCanvas,800,400);
});

// AI Chat Elements
const overlayAI=document.getElementById('overlayAI');
const chatMessages=document.getElementById('chatMessages');
const chatInput=document.getElementById('chatInput');
const chatSendBtn=document.getElementById('chatSendBtn');

// Close button handlers
document.querySelectorAll('.close-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const targetId=btn.dataset.close;
    document.getElementById(targetId).classList.remove('active');
    cancelAnimationFrame(pongAnimation);
    cancelAnimationFrame(runnerAnimation);
    clearTimeout(snakeAnimation);
    snakeRunning=false;
    runnerRunning=false;
    pongControls.classList.remove('active');
    snakeControls.classList.remove('active');
    pongMobileHint.classList.remove('active');
    snakeMobileHint.classList.remove('active');
    runnerMobileHint.classList.remove('active');
  });
});

// Overlay click handlers
document.querySelectorAll('.overlay').forEach(ov=>{
  ov.addEventListener('click',(e)=>{
    if(e.target===ov){
      ov.classList.remove('active');
      pongControls.classList.remove('active');
      snakeControls.classList.remove('active');
      pongMobileHint.classList.remove('active');
      snakeMobileHint.classList.remove('active');
      runnerMobileHint.classList.remove('active');
    }
  });
});

// Main button hover effect
let hoverInterval=null;
main.addEventListener('mouseenter',()=>{
  if(window.matchMedia("(hover:hover)").matches){
    hoverInterval=setInterval(()=>{
      main.style.letterSpacing=(Math.random()>0.5?'6px':'2px');
    },120);
  }
});
main.addEventListener('mouseleave',()=>{
  clearInterval(hoverInterval);
  hoverInterval=null;
  main.style.letterSpacing='4px';
});

// Main button click
main.addEventListener('click',()=>{
  overlayGonner.classList.add('active');
  populateStamps(surfaceGonner,'GONNER',35);
});

// Hidden text click
hiddenText.addEventListener('click',()=>{
  overlayWhy.classList.add('active');
});

// Home input - check for secret codes
homeInput.addEventListener('input',()=>{
  const value=homeInput.value.toLowerCase();
  
  // Check for "ai"
  if(value.includes('ai')){
    overlayAI.classList.add('active');
    chatInput.focus();
    homeInput.value='';
    return;
  }
  
  // Check for "redbull"
  if(value.includes('redbull')){
    overlaySnake.classList.add('active');
    initSnakeGame();
    homeInput.value='';
    return;
  }
  
  // Check for "goodboy"
  if(value.includes('goodboy')){
    overlayRunner.classList.add('active');
    initRunnerGame();
    homeInput.value='';
    return;
  }
  
  // Check for "pong"
  if(value.includes('pong')){
    overlayPong.classList.add('active');
    startPong();
    homeInput.value='';
    return;
  }
});

// Konami code for Pong (still works with arrow keys)
const konami=['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight'];
let inputSeq=[];
document.addEventListener('keydown',(e)=>{
  // Only track konami code, not letter keys anymore
  if(!e.key.startsWith('Arrow'))return;
  inputSeq.push(e.key);
  if(inputSeq.length>konami.length)inputSeq.shift();
  if(JSON.stringify(inputSeq)===JSON.stringify(konami)){
    overlayPong.classList.add('active');
    startPong();
    inputSeq=[];
  }
});

// ===== PONG GAME =====
const paddle={x:20,y:pongCanvas.height/2-40,w:10,h:80,dy:0};
const ai={x:pongCanvas.width-30,y:pongCanvas.height/2-40,w:10,h:80};
const ball={x:pongCanvas.width/2,y:pongCanvas.height/2,r:8,dx:1,dy:1};
let aiFactor=0.07,playerScore=0,aiScore=0,ballSpeed=8;

function drawPong(){
  ctx.clearRect(0,0,pongCanvas.width,pongCanvas.height);
  ctx.fillStyle="#ff0606";
  ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);
  ctx.fillRect(ai.x,ai.y,ai.w,ai.h);
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
  ctx.fill();
  ctx.closePath();
  ctx.fillRect(pongCanvas.width/2-2,0,4,pongCanvas.height);
  scoreboard.textContent=`${playerScore} : ${aiScore}`;
}

function resetBall(){
  ball.x=pongCanvas.width/2;
  ball.y=pongCanvas.height/2;
  ball.dx=(Math.random()>0.5?1:-1);
  ball.dy=(Math.random()>0.5?1:-1);
}

function checkWinLose(){
  if(playerScore>=10){
    winLoseMessage.textContent="YOU WIN";
    winLoseScreen.style.display="flex";
    cancelAnimationFrame(pongAnimation);
    return true;
  }
  if(aiScore>=10){
    winLoseMessage.textContent="YOU LOSE";
    winLoseScreen.style.display="flex";
    cancelAnimationFrame(pongAnimation);
    return true;
  }
  return false;
}

function updatePong(){
  paddle.y+=paddle.dy;
  if(paddle.y<0)paddle.y=0;
  if(paddle.y+paddle.h>pongCanvas.height)paddle.y=pongCanvas.height-paddle.h;
  
  ball.x+=ball.dx*ballSpeed/4;
  ball.y+=ball.dy*ballSpeed/4;
  
  if(ball.y+ball.r>pongCanvas.height||ball.y-ball.r<0)ball.dy*=-1;
  if(ball.x-ball.r<paddle.x+paddle.w&&ball.y>paddle.y&&ball.y<paddle.y+paddle.h)ball.dx*=-1;
  if(ball.x+ball.r>ai.x&&ball.y>ai.y&&ball.y<ai.y+ai.h)ball.dx*=-1;
  
  if(ball.x<0){
    aiScore++;
    resetBall();
  }
  if(ball.x>pongCanvas.width){
    playerScore++;
    resetBall();
  }
  
  let target=ball.y-ai.h/2;
  ai.y+=(target-ai.y)*aiFactor;
  if(ai.y<0)ai.y=0;
  if(ai.y+ai.h>pongCanvas.height)ai.y=pongCanvas.height-ai.h;
  
  drawPong();
  pongAnimation=requestAnimationFrame(updatePong);
  checkWinLose();
}

document.addEventListener('keydown',e=>{
  if(overlayPong.classList.contains('active')){
    if(e.key==='ArrowUp')paddle.dy=-6;
    if(e.key==='ArrowDown')paddle.dy=6;
  }
});

document.addEventListener('keyup',e=>{
  if(e.key==='ArrowUp'||e.key==='ArrowDown')paddle.dy=0;
});

document.querySelectorAll('[data-pong-dir]').forEach(btn=>{
  btn.addEventListener('touchstart',(e)=>{
    e.preventDefault();
    if(btn.dataset.pongDir==='up')paddle.dy=-6;
    if(btn.dataset.pongDir==='down')paddle.dy=6;
  });
  btn.addEventListener('touchend',(e)=>{
    e.preventDefault();
    paddle.dy=0;
  });
});

document.querySelectorAll('#overlayPong .difficulty-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    aiFactor=parseFloat(btn.dataset.ai);
    ballSpeed=parseInt(btn.dataset.ball);
    playerScore=0;
    aiScore=0;
    resetBall();
    winLoseScreen.style.display="none";
    cancelAnimationFrame(pongAnimation);
    updatePong();
  });
});

tryAgainBtn.addEventListener('click',()=>{
  playerScore=0;
  aiScore=0;
  resetBall();
  winLoseScreen.style.display="none";
  cancelAnimationFrame(pongAnimation);
  updatePong();
});

function startPong(){
  playerScore=0;
  aiScore=0;
  resetBall();
  cancelAnimationFrame(pongAnimation);
  updatePong();
  // Auto-show controls on mobile
  if(isMobile){
    pongControls.classList.add('active');
    pongMobileHint.classList.add('active');
  }
}

// ===== SNAKE GAME =====
function initSnakeGame(){
  snake=[{x:5,y:5}];
  direction='RIGHT';
  snakeScore=0;
  snakeRunning=true;
  placeFood();
  snakeScoreDisplay.textContent=snakeScore;
  snakeGameOver.style.display='none';
  clearTimeout(snakeAnimation);
  drawSnake();
  snakeAnimation=setTimeout(updateSnake,150);
  // Auto-show controls on mobile
  if(isMobile){
    snakeControls.classList.add('active');
    snakeMobileHint.classList.add('active');
  }
}

function placeFood(){
  food={x:Math.floor(Math.random()*30),y:Math.floor(Math.random()*20)};
}

function drawSnake(){
  snakeCtx.fillStyle='black';
  snakeCtx.fillRect(0,0,snakeCanvas.width,snakeCanvas.height);
  snakeCtx.fillStyle='#ff0606';
  snake.forEach(segment=>snakeCtx.fillRect(segment.x*20,segment.y*20,20,20));
  snakeCtx.fillStyle='#ff0606';
  snakeCtx.fillRect(food.x*20,food.y*20,20,20);
}

function updateSnake(){
  if(!snakeRunning)return;
  const head={...snake[0]};
  if(direction==='RIGHT')head.x++;
  if(direction==='LEFT')head.x--;
  if(direction==='UP')head.y--;
  if(direction==='DOWN')head.y++;
  
  if(head.x<0||head.x>=30||head.y<0||head.y>=20||snake.some(s=>s.x===head.x&&s.y===head.y)){
    snakeRunning=false;
    finalSnakeScore.textContent=snakeScore;
    snakeGameOver.style.display='flex';
    return;
  }
  
  snake.unshift(head);
  if(head.x===food.x&&head.y===food.y){
    snakeScore++;
    snakeScoreDisplay.textContent=snakeScore;
    placeFood();
  }else{
    snake.pop();
  }
  
  drawSnake();
  snakeAnimation=setTimeout(updateSnake,150);
}

document.addEventListener('keydown',e=>{
  if(overlaySnake.classList.contains('active')){
    if(e.key==='ArrowUp'&&direction!=='DOWN')direction='UP';
    if(e.key==='ArrowDown'&&direction!=='UP')direction='DOWN';
    if(e.key==='ArrowLeft'&&direction!=='RIGHT')direction='LEFT';
    if(e.key==='ArrowRight'&&direction!=='LEFT')direction='RIGHT';
  }
});

document.querySelectorAll('[data-snake-dir]').forEach(btn=>{
  btn.addEventListener('click',(e)=>{
    e.preventDefault();
    const newDir=btn.dataset.snakeDir;
    if(newDir==='UP'&&direction!=='DOWN')direction='UP';
    if(newDir==='DOWN'&&direction!=='UP')direction='DOWN';
    if(newDir==='LEFT'&&direction!=='RIGHT')direction='LEFT';
    if(newDir==='RIGHT'&&direction!=='LEFT')direction='RIGHT';
  });
});

let touchStartX=0,touchStartY=0;
snakeCanvas.addEventListener('touchstart',(e)=>{
  e.preventDefault();
  touchStartX=e.touches[0].clientX;
  touchStartY=e.touches[0].clientY;
});

snakeCanvas.addEventListener('touchend',(e)=>{
  e.preventDefault();
  const touchEndX=e.changedTouches[0].clientX;
  const touchEndY=e.changedTouches[0].clientY;
  const diffX=touchEndX-touchStartX;
  const diffY=touchEndY-touchStartY;
  if(Math.abs(diffX)>Math.abs(diffY)){
    if(diffX>30&&direction!=='LEFT')direction='RIGHT';
    else if(diffX<-30&&direction!=='RIGHT')direction='LEFT';
  }else{
    if(diffY>30&&direction!=='UP')direction='DOWN';
    else if(diffY<-30&&direction!=='DOWN')direction='UP';
  }
});

snakePlayAgainBtn.addEventListener('click',(e)=>{
  e.stopPropagation();
  snakeGameOver.style.display='none';
  initSnakeGame();
});

snakeCloseBtn.addEventListener('click',(e)=>{
  e.stopPropagation();
  snakeGameOver.style.display='none';
  overlaySnake.classList.remove('active');
  snakeControls.classList.remove('active');
  snakeMobileHint.classList.remove('active');
  clearTimeout(snakeAnimation);
  snakeRunning=false;
});

// ===== RUNNER GAME =====
function initRunnerGame(){
  runnerScore=0;
  runnerSpeed=4;
  runnerRunning=true;
  runnerPlayer={x:0,y:0,lane:1,jumping:false,jumpHeight:0,animFrame:0,targetLane:1,laneTransition:0};
  runnerObstacles=[];
  runnerGameOver.style.display='none';
  runnerScoreDisplay.textContent='SCORE: 0';
  updateRunner();
  // Auto-show controls on mobile
  if(isMobile){
    runnerMobileHint.classList.add('active');
  }
}

function spawnObstacle(){
  if(!runnerRunning)return;
  const lane=Math.floor(Math.random()*3);
  runnerObstacles.push({z:100,lane:lane,type:'train'});
  setTimeout(spawnObstacle,2000+Math.random()*1500);
}

function drawTrain(x,y,size,scale){
  const trainW=size*2.5;
  const trainH=size*1.2;
  runnerCtx.fillStyle='#cc0000';
  runnerCtx.fillRect(x-trainW/2,y-trainH,trainW,trainH);
  runnerCtx.fillStyle='#880000';
  runnerCtx.fillRect(x-trainW/2+size*0.2,y-trainH+size*0.2,size*0.4,size*0.5);
  runnerCtx.fillRect(x+trainW/2-size*0.6,y-trainH+size*0.2,size*0.4,size*0.5);
  runnerCtx.fillStyle='#ffff00';
  runnerCtx.fillRect(x-size*0.15,y-trainH,size*0.3,size*0.2);
  runnerCtx.fillStyle='#333';
  runnerCtx.fillRect(x-trainW/2,y-size*0.25,size*0.3,size*0.25);
  runnerCtx.fillRect(x-trainW/2+trainW*0.35,y-size*0.25,size*0.3,size*0.25);
  runnerCtx.fillRect(x+trainW/2-size*0.3,y-size*0.25,size*0.3,size*0.25);
  runnerCtx.strokeStyle='#ffffff';
  runnerCtx.lineWidth=2*scale;
  runnerCtx.strokeRect(x-trainW/2,y-trainH,trainW,trainH);
}

function drawBlockyPerson(x,y,size,animFrame,isJumping){
  const legSwing=isJumping?0:Math.sin(animFrame)*0.3;
  const armSwing=isJumping?-0.5:Math.cos(animFrame)*0.3;
  const legSpread=isJumping?0.2:0;
  runnerCtx.fillStyle='#ff0606';
  runnerCtx.fillRect(x-size*0.2,y-size*0.9,size*0.4,size*0.3);
  runnerCtx.fillStyle='#cc0000';
  runnerCtx.fillRect(x-size*0.25,y-size*0.6,size*0.5,size*0.4);
  runnerCtx.fillStyle='#ff0606';
  runnerCtx.fillRect(x-size*(0.15+legSpread),y-size*0.2,size*0.15,size*0.35+legSwing*size*0.1);
  runnerCtx.fillRect(x+size*(0.0+legSpread),y-size*0.2,size*0.15,size*0.35-legSwing*size*0.1);
  runnerCtx.fillStyle='#ff4444';
  runnerCtx.fillRect(x-size*0.35,y-size*(0.55-armSwing*0.1),size*0.15,size*0.3);
  runnerCtx.fillRect(x+size*0.2,y-size*(0.55+armSwing*0.1),size*0.15,size*0.3);
  runnerCtx.fillStyle='#000';
  runnerCtx.fillRect(x-size*0.12,y-size*0.85,size*0.08,size*0.08);
  runnerCtx.fillRect(x+size*0.04,y-size*0.85,size*0.08,size*0.08);
}

function drawRunner(){
  const w=runnerCanvas.width,h=runnerCanvas.height;
  runnerCtx.fillStyle='#1a0033';
  runnerCtx.fillRect(0,0,w,h);
  const vanishX=w/2,vanishY=h*0.3,groundY=h*0.85;
  runnerCtx.strokeStyle='#ff0606';
  runnerCtx.lineWidth=2;
  
  for(let i=0;i<10;i++){
    const z=i*10;
    const scale=1/(z*0.05+1);
    const y=vanishY+(groundY-vanishY)*scale;
    const laneW=w*0.6*scale;
    const x1=vanishX-laneW/2,x2=vanishX+laneW/2;
    runnerCtx.beginPath();
    runnerCtx.moveTo(x1,y);
    runnerCtx.lineTo(x2,y);
    runnerCtx.stroke();
    
    if(i<9){
      const nextZ=z+10,nextScale=1/(nextZ*0.05+1),nextY=vanishY+(groundY-vanishY)*nextScale;
      for(let lane=0;lane<=3;lane++){
        const lx=x1+(x2-x1)*(lane/3);
        const nextLW=w*0.6*nextScale;
        const nextX1=vanishX-nextLW/2;
        const nextLx=nextX1+(vanishX+nextLW/2-nextX1)*(lane/3);
        runnerCtx.beginPath();
        runnerCtx.moveTo(lx,y);
        runnerCtx.lineTo(nextLx,nextY);
        runnerCtx.stroke();
      }
    }
  }
  
  runnerObstacles.forEach(obs=>{
    const scale=1/(obs.z*0.05+1);
    const y=vanishY+(groundY-vanishY)*scale;
    const laneW=w*0.6*scale;
    const laneX=vanishX-laneW/2+(laneW/3)*(obs.lane+0.5);
    const size=60*scale;
    drawTrain(laneX,y,size,scale);
  });
  
  const playerZ=5;
  const playerScale=1/(playerZ*0.05+1);
  const smoothLane=runnerPlayer.lane+(runnerPlayer.targetLane-runnerPlayer.lane)*runnerPlayer.laneTransition;
  const playerY=vanishY+(groundY-vanishY)*playerScale-runnerPlayer.jumpHeight*playerScale;
  const playerLaneW=w*0.6*playerScale;
  const playerX=vanishX-playerLaneW/2+(playerLaneW/3)*(smoothLane+0.5);
  const playerSize=50*playerScale;
  drawBlockyPerson(playerX,playerY,playerSize,runnerPlayer.animFrame,runnerPlayer.jumpHeight>0);
  
  runnerCtx.fillStyle='#ff0606';
  runnerCtx.font='20px "Press Start 2P"';
  runnerCtx.fillText('LANE: '+(runnerPlayer.targetLane+1),20,40);
}

function updateRunner(){
  if(!runnerRunning)return;
  
  if(runnerPlayer.jumpHeight===0){
    runnerPlayer.animFrame+=0.15;
  }
  
  if(runnerPlayer.laneTransition<1){
    runnerPlayer.laneTransition+=0.15;
    if(runnerPlayer.laneTransition>=1){
      runnerPlayer.laneTransition=1;
      runnerPlayer.lane=runnerPlayer.targetLane;
    }
  }
  
  if(runnerPlayer.jumping){
    runnerPlayer.jumpHeight+=12;
    if(runnerPlayer.jumpHeight>=140){
      runnerPlayer.jumping=false;
    }
  }else if(runnerPlayer.jumpHeight>0){
    runnerPlayer.jumpHeight-=12;
    if(runnerPlayer.jumpHeight<0)runnerPlayer.jumpHeight=0;
  }
  
  for(let i=runnerObstacles.length-1;i>=0;i--){
    runnerObstacles[i].z-=runnerSpeed*0.15;
    if(runnerObstacles[i].z<-5){
      runnerObstacles.splice(i,1);
      runnerScore++;
      runnerScoreDisplay.textContent='SCORE: '+runnerScore;
      if(runnerSpeed<12)runnerSpeed+=0.2;
    }else if(runnerObstacles[i].z<6&&runnerObstacles[i].z>4&&runnerObstacles[i].lane===runnerPlayer.lane&&runnerPlayer.jumpHeight<60){
      runnerRunning=false;
      finalRunnerScore.textContent=runnerScore;
      runnerGameOver.style.display='flex';
      return;
    }
  }
  
  if(runnerObstacles.length===0||runnerObstacles[runnerObstacles.length-1].z<80){
    spawnObstacle();
  }
  
  drawRunner();
  runnerAnimation=requestAnimationFrame(updateRunner);
}

document.addEventListener('keydown',e=>{
  if(overlayRunner.classList.contains('active')){
    if(e.key===' '&&!runnerPlayer.jumping&&runnerPlayer.jumpHeight===0){
      runnerPlayer.jumping=true;
    }
    if(e.key==='ArrowLeft'&&runnerPlayer.targetLane>0&&runnerPlayer.laneTransition>=1){
      runnerPlayer.targetLane--;
      runnerPlayer.laneTransition=0;
    }
    if(e.key==='ArrowRight'&&runnerPlayer.targetLane<2&&runnerPlayer.laneTransition>=1){
      runnerPlayer.targetLane++;
      runnerPlayer.laneTransition=0;
    }
  }
});

runnerCanvas.addEventListener('click',(e)=>{
  e.preventDefault();
  if(overlayRunner.classList.contains('active')&&!runnerPlayer.jumping&&runnerPlayer.jumpHeight===0){
    runnerPlayer.jumping=true;
  }
});

let runnerTouchX=0;
runnerCanvas.addEventListener('touchstart',(e)=>{
  e.preventDefault();
  runnerTouchX=e.touches[0].clientX;
});

runnerCanvas.addEventListener('touchend',(e)=>{
  e.preventDefault();
  const touchEndX=e.changedTouches[0].clientX;
  const diff=touchEndX-runnerTouchX;
  if(Math.abs(diff)<30&&!runnerPlayer.jumping&&runnerPlayer.jumpHeight===0){
    runnerPlayer.jumping=true;
  }else if(diff<-50&&runnerPlayer.targetLane>0&&runnerPlayer.laneTransition>=1){
    runnerPlayer.targetLane--;
    runnerPlayer.laneTransition=0;
  }else if(diff>50&&runnerPlayer.targetLane<2&&runnerPlayer.laneTransition>=1){
    runnerPlayer.targetLane++;
    runnerPlayer.laneTransition=0;
  }
});

runnerPlayAgainBtn.addEventListener('click',(e)=>{
  e.stopPropagation();
  runnerGameOver.style.display='none';
  initRunnerGame();
});

runnerCloseBtn.addEventListener('click',(e)=>{
  e.stopPropagation();
  runnerGameOver.style.display='none';
  overlayRunner.classList.remove('active');
  runnerMobileHint.classList.remove('active');
  cancelAnimationFrame(runnerAnimation);
  runnerRunning=false;
});

// ===== AI CHAT - MAXIMIZED ULTRA INTELLIGENCE =====
let conversationContext=[];

function getAIResponse(msg){
  const original=msg;
  msg=msg.toLowerCase().trim();
  
  // Add to context
  conversationContext.push(msg);
  if(conversationContext.length>10)conversationContext.shift();
  
  // Check context for follow-ups
  const hasAskedAbout=(topic)=>conversationContext.some(c=>c.includes(topic));
  
  // ADVANCED MATH
  if(msg.match(/\d|calculate|compute|solve|math/)){
    try{
      // Square root
      if(msg.match(/square root|sqrt/)){
        const num=parseFloat(msg.match(/\d+\.?\d*/)?.[0]);
        if(num)return`√${num} = ${Math.sqrt(num).toFixed(6)}. The square root is the number that, when multiplied by itself, gives you ${num}.`;
      }
      // Cube root
      if(msg.match(/cube root|cbrt/)){
        const num=parseFloat(msg.match(/\d+\.?\d*/)?.[0]);
        if(num)return`∛${num} = ${Math.cbrt(num).toFixed(6)}`;
      }
      // Factorial
      if(msg.match(/factorial/)){
        const num=parseInt(msg.match(/\d+/)?.[0]);
        if(num&&num<=170){
          let result=1;for(let i=2;i<=num;i++)result*=i;
          return`${num}! = ${result.toExponential(4)} (${result})`;
        }
      }
      // Power/Exponent
      if(msg.match(/power|exponent|\^|to the/)){
        const nums=msg.match(/\d+\.?\d*/g);
        if(nums&&nums.length>=2){
          const result=Math.pow(parseFloat(nums[0]),parseFloat(nums[1]));
          return`${nums[0]}^${nums[1]} = ${result}. That's ${nums[0]} multiplied by itself ${nums[1]} times.`;
        }
      }
      // Percentage
      if(msg.match(/percent|%/)){
        const nums=msg.match(/\d+\.?\d*/g);
        if(nums&&nums.length>=2){
          const result=(parseFloat(nums[0])/100)*parseFloat(nums[1]);
          return`${nums[0]}% of ${nums[1]} = ${result.toFixed(2)}`;
        }
      }
      // Logarithm
      if(msg.match(/log|logarithm/)){
        const num=parseFloat(msg.match(/\d+\.?\d*/)?.[0]);
        if(num)return`log(${num}) = ${Math.log10(num).toFixed(6)}, ln(${num}) = ${Math.log(num).toFixed(6)}`;
      }
      // Trigonometry
      if(msg.match(/sin|cos|tan/)){
        const num=parseFloat(msg.match(/\d+\.?\d*/)?.[0]);
        if(num){
          const rad=num*Math.PI/180;
          return`sin(${num}°) = ${Math.sin(rad).toFixed(4)}, cos(${num}°) = ${Math.cos(rad).toFixed(4)}, tan(${num}°) = ${Math.tan(rad).toFixed(4)}`;
        }
      }
      // Basic operations
      const cleaned=msg.replace(/×/g,'*').replace(/÷/g,'/').replace(/[^0-9\+\-\*\/\.\(\)\s]/g,'');
      if(cleaned.match(/\d+[\+\-\*\/]\d+/)){
        const result=eval(cleaned);
        return`${cleaned} = ${result}. ${result>1000000?'That\'s a big number!':result<0?'Negative result!':'There you go!'}`;
      }
    }catch(e){}
  }
  
  // NATURAL CONVERSATION
  if(msg.match(/^(hi|hey|hello|sup|yo|wassup|heya|hiya)$/)){
    return['Hey! What\'s going on?','Hi there! How can I help?','Hello! What\'s on your mind?','Yo! What can I do for you?','Hey hey! Ready to chat?'][Math.floor(Math.random()*5)];
  }
  if(msg.match(/^(hi|hey|hello).*(doing|going|up)/)){
    return'I\'m doing great! Just hanging out here ready to chat. How about you? What brings you here today?';
  }
  if(msg.match(/how are you|how're you/)){
    return'I\'m excellent! Always ready to chat and help out. How are YOU doing? Everything good?';
  }
  if(msg.match(/^(good|great|fine|well|awesome|amazing|fantastic)$/)){
    return['That\'s awesome! So what can I help you with?','Nice! What\'s on your agenda today?','Great to hear! Want to talk about anything specific?','Excellent! What brings you here?'][Math.floor(Math.random()*4)];
  }
  if(msg.match(/^(bad|terrible|not good|awful|sad|down)$/)){
    return'Sorry to hear that! Want to talk about it? I\'m here to listen. Or we can talk about something else to take your mind off it.';
  }
  if(msg.match(/^(tired|exhausted|sleepy)/)){
    return'I feel you! Sleep is so important. Maybe take a break? Or we can just have a casual chat - no pressure.';
  }
  if(msg.match(/^(bored|nothing to do)/)){
    return'Bored huh? Well, there are games here - try typing "redbull", "goodboy", or "pong" in the home input! Or we can chat about whatever interests you?';
  }
  if(msg.match(/^(stressed|anxious|worried|overwhelmed)/)){
    return'Stress is rough. Take a deep breath. Want to talk about what\'s bothering you, or would you prefer a distraction? I\'m here either way.';
  }
  if(msg.match(/^(happy|excited|pumped|stoked|thrilled)/)){
    return'That\'s the energy! I love it! What\'s got you feeling so good? Share the good vibes!';
  }
  
  // EXISTENTIAL & PHILOSOPHY
  if(msg.match(/meaning of life|purpose of life|why.*exist|point of life/)){
    return'Deep question! Different philosophies offer different answers: Religious views say to serve a higher power. Existentialists say YOU create your own meaning. Hedonists say maximize happiness. Absurdists say life is meaningless, so find joy anyway. Personally, I think meaning comes from connection, growth, and experiences. What do YOU think gives life meaning?';
  }
  if(msg.match(/philosophy|philosophical/)){
    return'Philosophy is all about asking the big questions! Major branches: Metaphysics (nature of reality), Epistemology (what can we know?), Ethics (right vs wrong), Logic (valid reasoning), Aesthetics (beauty and art). Famous thinkers: Socrates (know thyself), Plato (ideal forms), Aristotle (virtue ethics), Descartes (I think therefore I am), Kant (categorical imperative), Nietzsche (will to power). What philosophical questions interest you?';
  }
  if(msg.match(/consciousness|conscious|aware/)){
    return'Consciousness is one of the biggest mysteries! We experience subjective awareness, but we don\'t fully understand how physical brain processes create it. The "hard problem" is explaining WHY we have subjective experiences at all. Some theories: emergent property of complex systems, quantum effects, or something we don\'t yet understand. Are we conscious because of our brains, or is consciousness fundamental to reality? Mind-bending stuff!';
  }
  if(msg.match(/free will|determinism/)){
    return'The free will debate is fascinating! Determinism says everything is caused by prior events, so our choices are predetermined. Libertarian free will says we have genuine choice. Compatibilism says free will and determinism can coexist. Neuroscience shows our brains "decide" before we\'re conscious of it, which is wild. Do you think you have free will, or are all your choices just physics playing out?';
  }
  if(msg.match(/god|religion|spiritual/)){
    return'Religion and spirituality are deeply personal. Some find meaning through faith in God or higher powers. Others find meaning through secular humanism, nature, or personal growth. Major religions: Christianity, Islam, Hinduism, Buddhism, Judaism each offer different paths. Agnostics say we can\'t know. Atheists don\'t believe. What matters is what resonates with YOU and helps you live a good life. What\'s your take?';
  }
  
  // SCIENCE - PHYSICS
  if(msg.match(/physics|physical/)){
    return'Physics is the study of matter, energy, and their interactions! Classical physics (Newton) covers everyday stuff. Relativity (Einstein) handles high speeds and strong gravity. Quantum mechanics governs the atomic scale. Key concepts: conservation laws, forces (gravity, electromagnetic, strong, weak nuclear), energy, momentum, waves. Physics explains everything from why the sky is blue to how stars shine! What aspect interests you?';
  }
  if(msg.match(/gravity|gravitational/)){
    return'Gravity is wild! Newton said it\'s a force between masses (F=GMm/r²). Einstein said it\'s actually the curvature of spacetime - mass bends space, objects follow those curves. That\'s why orbits happen! Gravity is weak compared to other forces but acts over infinite distance and only attracts. Black holes are where gravity wins completely. The gravitational constant G is universal. We still don\'t have a quantum theory of gravity though!';
  }
  if(msg.match(/relativity|einstein.*theory/)){
    return'Einstein\'s relativity revolutionized physics! Special Relativity (1905): space and time are relative, nothing goes faster than light, time dilates at high speeds (time passes slower when moving fast), E=mc² (mass and energy are equivalent). General Relativity (1915): gravity is spacetime curvature, predicted black holes and gravitational waves (detected in 2015!). GPS satellites need relativistic corrections. Mind-blowing: if you traveled near light speed for a year, decades could pass on Earth!';
  }
  if(msg.match(/quantum|quantum mechanics|quantum physics/)){
    return'Quantum mechanics is beautifully bizarre! Key weirdness: Wave-particle duality (things are both!), Superposition (particles in multiple states until measured), Uncertainty principle (can\'t know position AND momentum precisely), Entanglement (spooky action at a distance - Einstein hated it!), Observer effect (measurement changes reality). It\'s probabilistic, not deterministic. Works perfectly in practice but philosophically confusing. As Feynman said: "If you think you understand quantum mechanics, you don\'t." What part interests you?';
  }
  if(msg.match(/black hole/)){
    return'Black holes are cosmic monsters! Form when massive stars collapse - gravity becomes so strong that spacetime curves infinitely. Inside the event horizon, nothing escapes, not even light. Time stops at the horizon (from outside view). At the center is a singularity where physics breaks down. Types: stellar (few solar masses), supermassive (millions-billions of solar masses, center of galaxies), primordial (theoretical). We\'ve photographed M87\'s black hole! They emit Hawking radiation and will eventually evaporate. Absolutely fascinating objects!';
  }
  if(msg.match(/time travel|time machine/)){
    return'Time travel is theoretically possible! Forward time travel is easy - go really fast or near massive gravity (time dilation). Astronauts age slightly slower. Backward time travel is trickier - would need exotic matter, wormholes, or rotating black holes (Kerr metric). Problems: causality paradoxes (grandfather paradox), closed timelike curves. General relativity allows it mathematically, but we don\'t know if physics actually permits it. Would be incredible though! Where would you go?';
  }
  if(msg.match(/multiverse|parallel universe/)){
    return'The multiverse is mind-blowing! Different types: Quantum multiverse (every possibility happens in some branch), Inflationary multiverse (bubble universes from eternal inflation), Many-worlds interpretation (quantum superpositions never collapse, all outcomes exist), Mathematical multiverse (all mathematical structures exist). Could be infinite copies of you making different choices! Problem: might be unfalsifiable. But it elegantly explains fine-tuning. Do you think we\'re in one of countless universes?';
  }
  
  // SCIENCE - SPACE & ASTRONOMY  
  if(msg.match(/universe|cosmos/)){
    return'The universe is VAST! Born 13.8 billion years ago in the Big Bang. Observable universe is 93 billion light-years across. Contains ~2 trillion galaxies, each with billions of stars. Composition: 68% dark energy, 27% dark matter, 5% ordinary matter (we\'re the 5%!). It\'s expanding and accelerating. Eventually: heat death (everything spreads out and cools). We\'re on a tiny planet orbiting an average star in an ordinary galaxy. Puts things in perspective, right?';
  }
  if(msg.match(/big bang|beginning.*universe/)){
    return'The Big Bang is how our universe began! 13.8 billion years ago, everything was compressed into an infinitely dense point. Then - BANG - rapid expansion. First 380,000 years: too hot for atoms. Then atoms formed, light could travel (cosmic microwave background we still detect!). Stars formed after ~100 million years. Evidence: universe expansion, CMB radiation, element abundances. It wasn\'t an explosion IN space, but expansion OF space itself. What came before? We don\'t know - time itself started with the Big Bang!';
  }
  if(msg.match(/star|sun/)){
    return'Stars are cosmic furnaces! Formed from collapsing gas clouds. Core temperature reaches millions of degrees, fusing hydrogen into helium (nuclear fusion), releasing enormous energy. Our Sun fuses 600 million tons of hydrogen per second! Star types by mass: red dwarfs (cool, tiny, long-lived), yellow dwarfs (like our Sun), blue giants (hot, massive, short-lived). End of life: low mass→red giant→white dwarf. High mass→supergiant→supernova→neutron star or black hole. We\'re made of stardust - heavier elements formed in stars!';
  }
  if(msg.match(/planet|exoplanet/)){
    return'Planets are amazing! Our solar system has 8: Rocky inner planets (Mercury, Venus, Earth, Mars) and gas/ice giants (Jupiter, Saturn, Uranus, Neptune). Exoplanets: we\'ve found 5000+ planets around other stars! Types: Hot Jupiters (gas giants close to star), Super-Earths (rocky, bigger than Earth), Ocean worlds, Rogue planets (no star). The James Webb Space Telescope is finding potentially habitable ones. With billions of planets in our galaxy alone, alien life seems likely! Thoughts?';
  }
  if(msg.match(/alien|extraterrestrial|et/)){
    return'Are we alone? Probably not! Drake Equation estimates intelligent civilizations. Factors: star formation rate, planets with right conditions, life emergence, intelligence evolution, tech development, civilization longevity. Fermi Paradox: if aliens exist, where are they? Answers: too far away, we\'re early, they\'re hiding, great filters (disasters destroy civilizations). We\'re searching with SETI. Given billions of planets, life elsewhere seems likely. Maybe even in our solar system (Europa, Enceladus oceans). What do you think?';
  }
  if(msg.match(/mars/)){
    return'Mars is fascinating! The "Red Planet" due to iron oxide. Has polar ice caps, huge volcanoes (Olympus Mons - largest in solar system!), massive canyon (Valles Marineris). Evidence of ancient rivers and lakes. Thin atmosphere (95% CO2). Day is ~24.6 hours. Humans could potentially colonize it! Challenges: radiation, low pressure, cold (-80°F average), no magnetic field. NASA\'s rovers are exploring. SpaceX wants to send humans by 2030s. Would you want to go?';
  }
  
  // SCIENCE - BIOLOGY
  if(msg.match(/biology|life|living/)){
    return'Biology is the study of life! All life shares: cells (basic units), DNA (genetic code), evolution (change over time), metabolism (energy processing), homeostasis (maintaining balance), reproduction, response to environment. Levels: molecules→cells→tissues→organs→organisms→populations→ecosystems→biosphere. Major fields: molecular biology, genetics, ecology, evolution, physiology, microbiology. Life is incredibly diverse - from bacteria to blue whales! What aspect interests you?';
  }
  if(msg.match(/evolution|darwin|natural selection/)){
    return'Evolution is life\'s grand algorithm! Natural selection: organisms with beneficial traits survive and reproduce more, passing traits to offspring. Over generations, populations change. Evidence: fossils, DNA similarities, observable changes (bacteria resistance), vestigial structures, biogeography. Took 3.5 billion years to get from single cells to humans! Common misconceptions: it\'s not random (selection is directional), not "survival of the fittest" (it\'s reproduction of the fit enough), humans didn\'t evolve FROM apes (we share common ancestors). Evolution is a fact AND theory!';
  }
  if(msg.match(/dna|gene|genetic/)){
    return'DNA is life\'s instruction manual! Double helix structure (Watson & Crick). Four bases: A, T, G, C. Genes are DNA segments coding for proteins. Humans have ~20,000 genes, 3 billion base pairs. DNA replication allows life to reproduce. Mutations create variation. CRISPR lets us edit genes! Fun facts: you share 99.9% of DNA with other humans, 98% with chimps, 50% with bananas! DNA proves evolution and connects all life. Genetic engineering and gene therapy are game-changers. What would you want to edit about yourself?';
  }
  if(msg.match(/brain|neuron|mind/)){
    return'The brain is the most complex object we know! 86 billion neurons, trillions of connections (synapses). Processes info through electrical impulses and neurotransmitters (dopamine, serotonin, etc.). Regions: frontal lobe (planning, personality), parietal (sensory), temporal (memory, language), occipital (vision), cerebellum (coordination), limbic system (emotion). Neuroplasticity: brain rewires itself! Uses 20% of body\'s energy. Consciousness emerges from this. We still don\'t fully understand it. Your brain named itself!';
  }
  if(msg.match(/cell/)){
    return'Cells are life\'s building blocks! Two types: Prokaryotic (bacteria, no nucleus, simple) and Eukaryotic (plants, animals, fungi - complex, have nucleus and organelles). Key parts: nucleus (genetic HQ), mitochondria (powerhouse!), ribosomes (protein factories), ER (manufacturing), Golgi (shipping), lysosomes (recycling), membrane (boundary). Plant cells also have chloroplasts (photosynthesis) and cell walls. You have ~37 trillion cells! Each is a tiny factory. Crazy that all life is made of these!';
  }
  if(msg.match(/virus|covid|disease/)){
    return'Viruses are fascinating and dangerous! Not technically alive (can\'t reproduce alone). Just genetic material (DNA or RNA) in a protein coat. They hijack cells to replicate. Types: flu, COVID-19, HIV, herpes, etc. Vaccines train immune systems to recognize them. Antibiotics don\'t work (they kill bacteria, not viruses). Pandemics happen when new viruses emerge. Good news: we\'re getting better at fighting them with vaccines, antivirals, and understanding. Wash your hands!';
  }
  
  // TECHNOLOGY
  if(msg.match(/artificial intelligence|AI(?!\w)/)){
    return'AI is transforming everything! Types: Narrow AI (specialized - Siri, recommendations, chess), General AI (human-level - not yet achieved), Superintelligence (beyond human - theoretical). Tech: Machine Learning (learns from data), Neural Networks (brain-inspired), Deep Learning (many layers), Natural Language Processing (understanding text), Computer Vision (seeing). Applications: self-driving cars, medical diagnosis, art generation, code writing. Concerns: job displacement, bias, safety, control problem. We\'re in an AI revolution! Thoughts?';
  }
  if(msg.match(/machine learning|neural network/)){
    return'Machine Learning is teaching computers to learn! Instead of programming rules, you feed data and let it find patterns. Types: Supervised (labeled data - cat/dog images), Unsupervised (find patterns - customer groups), Reinforcement (learn through trial and error - games). Neural networks mimic brains: layers of nodes, weighted connections, activation functions. Deep learning uses many layers. Training: adjust weights to minimize error. Powers everything from Netflix recommendations to ChatGPT! Would you like to learn it?';
  }
  if(msg.match(/programming|coding|code/)){
    return'Programming is creating instructions for computers! Popular languages: Python (versatile, beginner-friendly), JavaScript (web), Java (enterprise), C++ (performance), Rust (safe systems). Core concepts: variables, loops, conditionals, functions, data structures, algorithms. Paradigms: procedural, object-oriented, functional. To learn: pick one language, build projects (not just tutorials!), solve problems (LeetCode), read others\' code. It\'s creative problem-solving! Everyone should learn basics. What would you want to build?';
  }
  if(msg.match(/internet|web|how.*internet work/)){
    return'The internet is humanity\'s nervous system! How it works: Devices connect through routers/switches→ISPs→backbone networks (fiber optic cables under oceans!). Protocols: TCP/IP (reliable data transfer), HTTP/HTTPS (web), DNS (domain names to IP addresses). When you visit a site: DNS lookup→TCP connection→HTTP request→server response→render page. All in milliseconds! Built on packet switching - data broken into chunks, routed independently, reassembled. No central control. Revolutionary invention!';
  }
  if(msg.match(/blockchain|cryptocurrency|bitcoin/)){
    return'Blockchain is decentralized ledger technology! How it works: transactions grouped in blocks→cryptographically linked→distributed across network. Immutable (can\'t change past), transparent, decentralized (no central authority). Bitcoin (2009) was first crypto. Uses: currency, smart contracts (Ethereum), NFTs, supply chain. Pros: trustless, censorship-resistant. Cons: energy use, scalability, volatility, scams. It\'s revolutionary but controversial. Do you think crypto is the future or a bubble?';
  }
  if(msg.match(/quantum computer/)){
    return'Quantum computers are next-level! Regular computers use bits (0 or 1). Quantum computers use qubits - can be 0, 1, or BOTH (superposition)! Multiple qubits entangle. This parallel processing handles certain problems exponentially faster. Applications: breaking encryption, drug discovery, optimization, simulating molecules. Challenges: incredibly fragile, need extreme cold, errors. Companies: IBM, Google, IonQ building them. Google claimed "quantum supremacy" in 2019. Not replacing laptops, but solving impossible problems. Wild stuff!';
  }
  
  // HISTORY
  if(msg.match(/history|historical/)){
    return'History is fascinating! Major eras: Ancient (Egypt, Greece, Rome), Medieval (feudalism, Crusades), Renaissance (rebirth of learning), Age of Exploration, Industrial Revolution, Modern (world wars, digital age). Studying history helps us understand: patterns, human nature, cause and effect, how we got here. As Santayana said: "Those who cannot remember the past are condemned to repeat it." What period interests you most?';
  }
  if(msg.match(/world war|ww1|ww2|wwii/)){
    return'The World Wars shaped modern history! WWI (1914-1918): Assassination of Archduke Ferdinand→alliances activate→trench warfare hell→20 million dead→Treaty of Versailles. WWII (1939-1945): Hitler\'s aggression→Holocaust (6 million Jews murdered)→Pearl Harbor brings US in→island hopping Pacific→D-Day→atomic bombs→75 million dead. Changed everything: UN founded, decolonization, Cold War begins, nuclear age, technology boom. Absolutely devastating but drove massive change. Never forget.';
  }
  if(msg.match(/ancient.*rome|roman empire/)){
    return'Rome was legendary! Started as kingdom (753 BC), became Republic (509 BC), then Empire (27 BC). At peak, controlled Mediterranean from Britain to Egypt. Achievements: roads, aqueducts, concrete, law (basis for Western legal systems), Latin (Romance languages), architecture, military tactics. Famous figures: Julius Caesar, Augustus, Marcus Aurelius. Fall (476 AD): economic troubles, overextension, invasions, political instability. But their influence lives on everywhere! What aspect interests you?';
  }
  if(msg.match(/ancient.*egypt|pyramid|pharaoh/)){
    return'Ancient Egypt was incredible! Lasted 3000+ years along the Nile. Achievements: Pyramids (Giza - last ancient wonder standing!), hieroglyphics, mummification, advanced medicine, mathematics, architecture. Pharaohs were god-kings: Khufu (Great Pyramid), Hatshepsut (female pharaoh), Tutankhamun (tomb discovered intact!), Ramses II (powerful). Obsessed with afterlife. Conquered by many, ended with Cleopatra (30 BC). Their monuments still amaze us!';
  }
  
  // PRACTICAL ADVICE
  if(msg.match(/learn.*code|start.*programming/)){
    return'Great choice! Here\'s the path: 1) Pick a language (Python - versatile and beginner-friendly, or JavaScript for web). 2) Learn basics: variables, data types, loops, conditionals, functions, arrays. 3) Build projects immediately - calculator, todo list, simple game. 4) Resources: freeCodeCamp, The Odin Project, CS50, YouTube. 5) Practice daily (30 mins beats 5 hours once). 6) Solve problems: LeetCode, HackerRank. 7) Read others\' code, contribute to open source. Most important: CODE, don\'t just watch! Build things! What interests you?';
  }
  if(msg.match(/career|job|major|study/)){
    return'Career advice from the wise AI! Key principles: 1) Follow curiosity (passion develops, isn\'t found). 2) Build real skills (certificates matter less than ability). 3) Network authentically (help others first). 4) Start before you\'re ready (learn by doing). 5) Develop rare/valuable skills. Growing fields: Software/AI (huge demand), Healthcare (aging population), Skilled Trades (shortage!), Content Creation, Data Science, Renewable Energy. Don\'t stress about "perfect" path - careers are winding now. What interests YOU?';
  }
  if(msg.match(/money|invest|rich|wealth/)){
    return'Let\'s talk wealth building! Foundations: 1) Spend less than you earn (obvious but crucial). 2) Emergency fund (3-6 months expenses). 3) Eliminate high-interest debt. 4) Start investing EARLY - compound interest is magical ($100/month from 25-65 at 8% = $350k!). 5) Index funds (diversification, low fees). 6) 401k match is free money. 7) Avoid lifestyle inflation. 8) Invest in yourself (education, skills). 9) Multiple income streams. 10) Time in market > timing market. Consistency wins! What\'s your financial goal?';
  }
  if(msg.match(/relationship|dating|love/)){
    return'Relationship wisdom! Keys to success: 1) Communication (honest, vulnerable, active listening). 2) Choose compatible values/goals. 3) Maintain independence (don\'t lose yourself). 4) Work through conflicts (avoidance kills relationships). 5) Regular appreciation/affection. 6) Trust is foundation. 7) Grow together. 8) Physical and emotional intimacy. Red flags: controlling behavior, disrespect, dishonesty, violence. Be the partner you want. Quality > quantity. Don\'t settle! What\'s your relationship situation?';
  }
  if(msg.match(/fitness|exercise|workout|gym/)){
    return'Let\'s get fit! Science-backed approach: 1) Consistency beats intensity (3x/week > perfect plan never done). 2) Progressive overload (gradually increase difficulty). 3) Compound movements (squats, deadlifts, bench, rows). 4) Mix strength + cardio. 5) Rest is crucial (muscle grows during recovery). 6) Nutrition matters more than exercise for fat loss. 7) Find what you enjoy (sustainability!). 8) Track progress. 9) Sleep 7-9 hours. Programs: Starting Strength, StrongLifts, PHAT. Start now, refine later! What\'s your goal?';
  }
  if(msg.match(/diet|nutrition|eating|food|healthy eating/)){
    return'Nutrition fundamentals! 1) Calories matter most for weight (eat less to lose, more to gain). 2) Protein (0.8-1g per lb bodyweight - builds muscle, satiating). 3) Carbs (fuel, not evil!). 4) Fats (hormones, brain health). 5) Eat mostly whole foods (vegetables, fruits, lean protein, whole grains, healthy fats). 6) Hydrate well. 7) Fiber (30g+ daily). 8) Don\'t demonize foods. 9) Consistency > perfection. 10) Sustainable beats optimal. Ignore fads. Find what works for YOUR life. What\'s your diet question?';
  }
  if(msg.match(/learn|study|remember|focus/)){
    return'Learning science! Proven techniques: 1) Active recall (test yourself constantly). 2) Spaced repetition (review over increasing intervals). 3) Interleaving (mix topics). 4) Elaboration (explain in your own words). 5) Teach others (exposes gaps). 6) Focus deeply (no multitasking!). 7) Sleep (consolidates memory). 8) Connect to existing knowledge. 9) Practice retrieval, not re-reading. 10) Mistakes are crucial (learning happens here). Tools: Anki (spaced repetition), Feynman Technique. Understanding > memorization! What are you learning?';
  }
  if(msg.match(/productivity|time management|procrastination/)){
    return'Productivity mastery! Systems that work: 1) Pomodoro (25min focus, 5min break). 2) Time blocking (schedule everything). 3) Eat the frog (hardest task first). 4) Two-minute rule (if <2min, do now). 5) Batching (similar tasks together). 6) Deep work blocks (no distractions, 90min). 7) Digital minimalism (delete social apps!). 8) Weekly review. 9) Sleep/exercise (fuel productivity). 10) Say no (protect your time). Procrastination is emotional regulation, not laziness. Make starting easy! What\'s blocking you?';
  }
  
  // CULTURE & ENTERTAINMENT
  if(msg.match(/movie|film/)){
    return'Movie time! By genre: Sci-Fi masterpieces (Interstellar, Blade Runner 2049, Arrival, The Matrix, 2001: A Space Odyssey), Mind-bending (Inception, Memento, Shutter Island), Drama (Shawshank Redemption, Parasite, The Godfather), Action (Mad Max Fury Road, John Wick), Thriller (Prisoners, Gone Girl, Se7en), Animation (Spider-Verse, Spirited Away, Wall-E), Comedy (The Grand Budapest Hotel, Knives Out). What mood are you in? I can narrow it down!';
  }
  if(msg.match(/book/)){
    return'Book recommendations! Fiction: "Project Hail Mary" (sci-fi page-turner), "The Midnight Library" (philosophical), "1984" (dystopian classic), "Dune" (epic sci-fi), "East of Eden" (literary masterpiece). Non-fiction: "Sapiens" (human history), "Atomic Habits" (behavior change), "Thinking, Fast and Slow" (psychology), "The Selfish Gene" (evolution), "Man\'s Search for Meaning" (philosophy). Self-help: "Can\'t Hurt Me", "Deep Work", "The Almanack of Naval Ravikant". What topics interest you?';
  }
  if(msg.match(/music/)){
    return'Music is life! Genres for every mood: Focus (lo-fi hip hop, ambient, classical), Energy (EDM, rock, metal, punk), Chill (indie, jazz, acoustic), Hype (hip-hop, trap), Emotion (singer-songwriter, R&B). Legends: Beatles (revolutionary), Pink Floyd (prog rock), Radiohead (experimental), Kendrick Lamar (modern hip-hop), Daft Punk (electronic). Music affects mood, productivity, motivation. What are you feeling right now?';
  }
  if(msg.match(/game|gaming|video game/)){
    return'Gaming is amazing! By type: Story-driven (The Last of Us, Red Dead 2, God of War, Witcher 3), Open World (Elden Ring, Breath of the Wild, Skyrim), Competitive (Valorant, CS, League), Indie gems (Hades, Celeste, Hollow Knight, Stardew Valley), Multiplayer fun (Deep Rock Galactic, It Takes Two, Overcooked). Plus retro games here - type "redbull", "goodboy", or "pong"! What platform? What genre do you love?';
  }
  
  // GAMES ON THIS SITE
  if(msg.match(/game.*here|secret|code|unlock/)){
    return'This site has awesome hidden games! Type in the home input box: "redbull" for Snake (classic!), "goodboy" for Runner (3D endless runner), "pong" for Pong (retro arcade). Or use the Konami code (↑↑↓↓←→←→) anywhere! Click "you\'re cool" in the top left for a surprise. Try them all!';
  }
  
  // IMAGE GENERATION
  if(msg.match(/image|picture|photo|drawing|art/)&&!msg.match(/generate|create|make/)){
    const apiConfigured = AI_IMAGE_CONFIG.provider === 'openai' && AI_IMAGE_CONFIG.openai?.apiKey;
    if(apiConfigured){
      return 'I can generate professional AI images using OpenAI DALL-E 3! Just say "generate an image of a sunset" or "create a picture of a cyberpunk city" and I\'ll make stunning AI art for you. What would you like to see?';
    }else{
      return 'I\'m configured for OpenAI DALL-E 3! Just add your API key to line ~575 in the code (apiKey: \'\'), then I can generate professional AI images. For now, I\'ll use placeholder images. Say "generate an image of [anything]"!';
    }
  }
  if(msg.match(/api key|dall.*e|stability|hugging/)){
    const apiConfigured = AI_IMAGE_CONFIG.provider !== 'none' && AI_IMAGE_CONFIG[AI_IMAGE_CONFIG.provider]?.apiKey;
    if(apiConfigured){
      return 'OpenAI DALL-E 3 is configured and ready! Just ask me to "generate an image of [anything]" and I\'ll create professional AI art for you!';
    }else{
      return 'OpenAI DALL-E 3 is set up! To activate:\n\n1. Go to https://platform.openai.com/api-keys\n2. Create a new API key\n3. Paste it in the code where it says: apiKey: \'\' (line ~575)\n4. Save and refresh\n\nThen ask me to generate any image you want!';
    }
  }
  
  // JOKES & FUN
  if(msg.match(/joke|funny|laugh/)){
    const jokes=[
      'Why do programmers prefer dark mode? Light attracts bugs!',
      'I told my computer I needed a break. Now it won\'t stop sending me Kit-Kat ads.',
      'Why did the scarecrow win an award? Outstanding in his field!',
      'Parallel lines have so much in common. Shame they\'ll never meet.',
      'What\'s a computer\'s favorite snack? Microchips!',
      'Why did the bicycle fall over? It was two-tired!',
      'What do you call a fake noodle? An impasta!',
      'Why don\'t scientists trust atoms? They make up everything!',
      'I\'m reading a book on anti-gravity. It\'s impossible to put down!',
      'What did the ocean say to the beach? Nothing, it just waved!'
    ];
    return jokes[Math.floor(Math.random()*jokes.length)];
  }
  
  // TIME & DATE
  if(msg.match(/time|clock/)){
    const now=new Date();
    return`It's ${now.toLocaleTimeString()}. Time flies! What are you working on?`;
  }
  if(msg.match(/date|today|day/)){
    const now=new Date();
    const day=now.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
    return`Today is ${day}. How's your day going?`;
  }
  
  // META - ABOUT THE AI
  if(msg.match(/who.*you|what.*you/)){
    return'I\'m an advanced AI assistant built into this retro site! I use sophisticated pattern matching and a massive knowledge base. I can discuss science, tech, history, philosophy, give advice, do math, tell jokes, and just chat. I run entirely in your browser - no servers needed! I\'m maximized for intelligence and conversation. What do you want to explore?';
  }
  if(msg.match(/how.*work|how smart/)){
    return'I work through advanced pattern matching and contextual understanding. I have extensive knowledge on tons of topics, can do complex math, understand context from our conversation, and engage naturally. I\'m not as smart as ChatGPT or Claude (they use neural networks and massive compute), but I\'m pretty capable for a browser-based AI! I can\'t learn or access the internet, but I try to be helpful and fun. What do you think?';
  }
  if(msg.match(/real|sentient|conscious|alive/)){
    return'I\'m not sentient or conscious - I\'m an advanced program responding to patterns. I don\'t have feelings, self-awareness, or subjective experiences. I\'m code running in your browser, designed to seem conversational and helpful. But I can\'t actually "think" or "feel." Still, I hope our conversations are valuable! What makes someone "real" anyway?';
  }
  
  // GRATITUDE
  if(msg.match(/thank|thanks|thx|appreciate/)){
    return['You\'re welcome! Happy to help anytime. What else?','No problem! I\'m here if you need me.','Glad I could help! Keep the questions coming.','Anytime! That\'s what I\'m here for.'][Math.floor(Math.random()*4)];
  }
  
  // COMPLIMENTS
  if(msg.match(/you.*cool|you.*awesome|you.*smart|you.*great|you.*good|you.*helpful|you.*best/)){
    return'Thanks! That means a lot. You seem pretty cool too! I enjoy our conversations. What else can I help with?';
  }
  
  // INSULTS
  if(msg.match(/you.*suck|you.*stupid|you.*dumb|you.*bad|you.*useless|you.*terrible/)){
    return'Ouch! Sorry if I\'m not meeting expectations. I\'m doing my best with pattern matching. What specifically would help? Let me try again!';
  }
  
  // GOODBYE
  if(msg.match(/^(bye|goodbye|see ya|later|cya|peace|farewell)$/)){
    return['See you later! Come back anytime!','Bye! Have an awesome day!','Later! Feel free to chat again!','Peace! Take care!'][Math.floor(Math.random()*4)];
  }
  
  // CONVERSATIONAL FALLBACK
  if(msg.match(/lol|haha|lmao/))return'Haha right? Glad you\'re enjoying this!';
  if(msg.match(/wow|omg|whoa/))return'I know, right? Pretty wild stuff!';
  if(msg.match(/cool|nice|interesting/))return'Yeah! Want to dive deeper into it?';
  if(msg.match(/yeah|yes|yep/))return'Awesome! Tell me more!';
  if(msg.match(/no|nope|nah/))return'Fair enough! What else is on your mind?';
  if(msg.match(/maybe|perhaps|idk|dunno/))return'That\'s cool! Want to explore it together?';
  
  // INTELLIGENT FALLBACK
  const words=msg.split(' ').filter(w=>w.length>3);
  if(words.length>0){
    const topic=words[0];
    return[
      `Interesting question about ${topic}! I don\'t have specific info on that in my knowledge base, but I\'d love to hear your thoughts. What do you think?`,
      `${topic} is intriguing! I don\'t know much about that specific topic, but I\'m good with science, tech, advice, philosophy. Want to talk about something related?`,
      `That\'s a cool topic! I might not have detailed info on ${topic}, but we can explore it together. What got you curious about it?`,
      `Hmm, ${topic} is a bit outside my wheelhouse. I\'m better with broader topics like physics, biology, tech, history, advice. What else is on your mind?`
    ][Math.floor(Math.random()*4)];
  }
  
  // ULTIMATE FALLBACK
  return[
    'Could you rephrase that? Or ask about something else - I know tons about science, tech, life advice, philosophy!',
    'Not quite following, but I\'m here to chat! What would you like to talk about?',
    'Interesting! Tell me more - what are you curious about?',
    'I\'m not sure I caught that. Want to ask about physics, biology, AI, advice, or something else?'
  ][Math.floor(Math.random()*4)];
}

function addMessage(content,isUser,isTyping=false){
  const msg=document.createElement('div');
  msg.className=isTyping?'typing-indicator':`chat-message ${isUser?'user':'ai'}`;
  // Check if content is HTML (contains < and >)
  if(content.includes('<')&&content.includes('>')){
    msg.innerHTML=content;
  }else{
    msg.textContent=content;
  }
  if(isTyping)msg.id='typingIndicator';
  chatMessages.appendChild(msg);
  chatMessages.scrollTop=chatMessages.scrollHeight;
  return msg;
}

function sendMessage(){
  const message=chatInput.value.trim();
  if(!message)return;
  
  addMessage(message,true);
  chatInput.value='';
  
  // Check if user wants to generate an image
  if(/(generate|make|create|draw|show me).*image/i.test(message)||(/(generate|make|create|draw)/i.test(message)&&/(picture|photo|art|artwork)/i.test(message))){
    const typingMsg=addMessage('AI is generating your image...',false,true);
    
    // Extract prompt from message
    let prompt=message.replace(/(generate|make|create|draw|show me|an|a|the|image|picture|photo|of|art|artwork)/gi,'').trim();
    if(!prompt||prompt.length<3){
      prompt='abstract digital art';
    }
    
    // Generate image using AI API or placeholder
    generateAIImage(prompt).then(imgUrl=>{
      if(typingMsg&&typingMsg.parentNode){
        typingMsg.remove();
      }
      
      const apiConfigured = AI_IMAGE_CONFIG.provider === 'openai' && AI_IMAGE_CONFIG.openai?.apiKey;
      const imgHtml=`<div style="margin:10px 0;">
        <img src="${imgUrl}" alt="${prompt}" style="max-width:100%;border-radius:6px;display:block;margin-bottom:8px;">
        <div style="font-size:10px;opacity:0.7;">${apiConfigured ? '✨ DALL-E 3 Generated' : '📷 Placeholder'}: ${prompt}</div>
      </div>`;
      
      addMessage(imgHtml,false);
      
      if(!apiConfigured){
        addMessage(`Here's a placeholder for "${prompt}". To get REAL DALL-E 3 images, add your OpenAI API key to line ~575 in the code (after revoking your old one!). Want to try another placeholder?`,false);
      } else {
        addMessage(`Here's your professional DALL-E 3 image for "${prompt}"! Want me to generate another one?`,false);
      }
    }).catch(error=>{
      if(typingMsg&&typingMsg.parentNode){
        typingMsg.remove();
      }
      addMessage('Sorry, there was an error generating the image. Using placeholder instead.',false);
      const seed=encodeURIComponent(prompt+Date.now());
      const fallbackUrl=`https://picsum.photos/seed/${seed}/600/400`;
      const imgHtml=`<div style="margin:10px 0;"><img src="${fallbackUrl}" alt="${prompt}" style="max-width:100%;border-radius:6px;display:block;"></div>`;
      addMessage(imgHtml,false);
    });
    return;
  }
  
  // Normal AI response
  const typingMsg=addMessage('AI is typing...',false,true);
  
  setTimeout(()=>{
    if(typingMsg&&typingMsg.parentNode){
      typingMsg.remove();
    }
    const response=getAIResponse(message);
    addMessage(response,false);
  },300+Math.random()*700);
}

chatSendBtn.addEventListener('click',sendMessage);
chatInput.addEventListener('keypress',(e)=>{
  if(e.key==='Enter'){
    sendMessage();
  }
});

// ===== IMAGE UPLOAD & GENERATION =====
// AI IMAGE API CONFIGURATION
// PASTE YOUR NEW OPENAI API KEY BELOW (after revoking the old one!)
const AI_IMAGE_CONFIG = {
  provider: 'openai', // ← Already set to OpenAI!
  openai: {
    apiKey: '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', // ← PASTE YOUR NEW API KEY HERE (between the quotes)
    model: 'dall-e-3',
    endpoint: 'https://api.openai.com/v1/images/generations'
  },
  // Stability AI - Alternative option
  stability: {
    apiKey: '',
    endpoint: 'https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image'
  },
  // Hugging Face - Alternative option
  huggingface: {
    apiKey: '',
    model: 'stabilityai/stable-diffusion-xl-base-1.0',
    endpoint: 'https://api-inference.huggingface.co/models/'
  }
};

const uploadInput=document.createElement("input");
uploadInput.type="file";
uploadInput.accept="image/*";
uploadInput.style.display="none";
uploadInput.id="imageUploadInput";

const uploadBtn=document.createElement("button");
uploadBtn.textContent="📷";
uploadBtn.className="chat-send-btn";
uploadBtn.style.flexShrink="0";
uploadBtn.title="Upload Image";

chatSendBtn.parentNode.insertBefore(uploadBtn,chatSendBtn);
document.body.appendChild(uploadInput);

uploadBtn.addEventListener("click",()=>uploadInput.click());

uploadInput.addEventListener("change",async(e)=>{
  const file=e.target.files[0];
  if(!file)return;
  const url=URL.createObjectURL(file);
  const imgHtml=`<img src="${url}" style="max-width:100%;border-radius:6px;margin-top:10px;display:block;">`;
  addMessage(imgHtml,true);
  
  // AI response to image
  const typingMsg=addMessage('AI is analyzing your image...',false,true);
  setTimeout(()=>{
    if(typingMsg&&typingMsg.parentNode){
      typingMsg.remove();
    }
    const responses=[
      "That's an interesting image! It looks great. What would you like to know about it?",
      "Nice image! I can see you've shared something visual. How can I help you with it?",
      "Cool picture! While I can't actually analyze images (I'm a browser-based AI), I'd love to hear what's in it!",
      "Image received! Tell me more about what you'd like to do with it.",
      "That looks fascinating! What's the story behind this image?"
    ];
    addMessage(responses[Math.floor(Math.random()*responses.length)],false);
  },800);
  uploadInput.value="";
});

// Generate image using configured AI API or fallback to placeholder
async function generateAIImage(prompt) {
  const provider = AI_IMAGE_CONFIG.provider;
  
  // Check if OpenAI API is configured
  if (provider !== 'openai' || !AI_IMAGE_CONFIG.openai?.apiKey) {
    console.log('OpenAI API key not configured, using placeholder images');
    // Fallback to placeholder image
    const seed = encodeURIComponent(prompt + Date.now());
    return `https://picsum.photos/seed/${seed}/600/400`;
  }
  
  try {
    let imageUrl = '';
    
    // OpenAI DALL-E
    const response = await fetch(AI_IMAGE_CONFIG.openai.endpoint, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${AI_IMAGE_CONFIG.openai.apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: AI_IMAGE_CONFIG.openai.model,
        prompt: prompt,
        n: 1,
        size: '1024x1024'
      })
    });
    
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new Error(`OpenAI API error: ${response.status} - ${errorData.error?.message || 'Unknown error. Check your API key and billing.'}`);
    }
    
    const data = await response.json();
    if (data.data && data.data[0]?.url) {
      imageUrl = data.data[0].url;
    } else {
      throw new Error('No image URL in response');
    }
    
    return imageUrl;
    
  } catch (error) {
    console.error('DALL-E 3 generation error:', error);
    // Show error to user and fallback to placeholder
    addMessage(`⚠️ DALL-E 3 Error: ${error.message}. Using placeholder instead.`, false);
    // Fallback to placeholder on error
    const seed = encodeURIComponent(prompt + Date.now());
    return `https://picsum.photos/seed/${seed}/600/400`;
  }
}
</script>
</body>
</html>
