<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TheFoxsss Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<style>
body {
  margin:0; font-family:'Roboto',sans-serif; background:#36393f; color:#ddd; display:flex; justify-content:center; align-items:center; height:100vh;
}
#chat-container {
  background:#2f3136; width:400px; max-width:90%; border-radius:8px; display:flex; flex-direction:column; overflow:hidden; box-shadow:0 0 10px rgba(0,0,0,0.5);
}
#messages { flex:1; padding:10px; overflow-y:auto; display:flex; flex-direction:column; }
.message {
  margin-bottom:8px; padding:6px 10px; border-radius:8px; max-width:80%;
}
.message .username { font-weight:500; margin-right:5px; }
.message.self { background:#7289da; align-self:flex-end; color:#fff; }
.message.other { background:#40444b; align-self:flex-start; color:#ddd; }
#input-container { display:flex; padding:10px; background:#40444b; gap:5px; }
#message { flex:1; padding:8px; border-radius:5px; border:none; background:#202225; color:#ddd; }
#message:focus { outline:none; }
button { padding:8px 12px; background:#7289da; color:white; border:none; border-radius:5px; cursor:pointer; }
button:hover { background:#5b6eae; }
#username-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); display:flex; justify-content:center; align-items:center; z-index:10; flex-direction:column; }
#username-overlay input { padding:10px; border-radius:5px; border:none; margin-bottom:10px; width:250px; }
#username-overlay button { padding:10px 20px; }
</style>
</head>
<body>

<div id="chat-container">
  <div id="messages"></div>
  <div id="input-container">
    <input id="message" type="text" placeholder="Type a message..." disabled />
    <button onclick="sendMessage()" disabled>Send</button>
  </div>
</div>

<div id="username-overlay">
  <input id="username-input" type="text" placeholder="Enter your username" />
  <button onclick="setUsername()">Join Chat</button>
</div>

<script>
const workerURL = "https://aiworker.thefoxsss6969.workers.dev/";
let ws;
let username = "";
const messagesDiv = document.getElementById('messages');
const messageInput = document.getElementById('message');
const sendButton = document.querySelector('#input-container button');
const overlay = document.getElementById('username-overlay');
const usernameInput = document.getElementById('username-input');

function randomColor(str) {
  let hash = 0;
  for(let i=0;i<str.length;i++) hash = str.charCodeAt(i)+((hash<<5)-hash);
  const h = hash % 360;
  return `hsl(${h},70%,70%)`;
}

function addMessage(msgObj){
  const div = document.createElement('div');
  div.className = 'message';
  div.classList.add(msgObj.username===username?'self':'other');
  const color = randomColor(msgObj.username);
  div.innerHTML = `<span class="username" style="color:${color}">${msgObj.username}</span>: ${msgObj.text}`;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function setUsername(){
  const val = usernameInput.value.trim();
  if(!val) return alert("Enter a username");
  username = val;
  overlay.style.display = 'none';
  messageInput.disabled = false;
  sendButton.disabled = false;

  ws = new WebSocket(workerURL.replace(/^https?/, 'ws'));
  ws.onopen = () => console.log("Connected");
  ws.onmessage = e => {
    try {
      const msgObj = JSON.parse(e.data);
      addMessage(msgObj);
    } catch { console.error("Invalid message", e.data); }
  };
  ws.onerror = e => console.error("WebSocket error", e);
  ws.onclose = () => console.log("Disconnected");
}

function sendMessage(){
  const text = messageInput.value.trim();
  if(!text || !ws || ws.readyState!==WebSocket.OPEN) return;
  const msgObj = {username, text, timestamp: Date.now()};
  ws.send(JSON.stringify(msgObj));
  messageInput.value='';
  addMessage(msgObj); // show instantly
}

messageInput.addEventListener('keydown', e => { if(e.key==='Enter') sendMessage(); });
</script>
</body>
</html>
